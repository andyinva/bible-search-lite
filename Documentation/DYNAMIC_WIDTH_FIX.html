<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Width Fix</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: white;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }

        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 30px;
        }

        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }

        h4 {
            color: #34495e;
            margin-top: 20px;
        }

        p {
            margin: 15px 0;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 90%;
            color: #e74c3c;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
        }

        pre code {
            background: none;
            color: #ecf0f1;
            padding: 0;
            font-size: 14px;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin: 8px 0;
        }

        blockquote {
            border-left: 4px solid #3498db;
            margin: 20px 0;
            padding: 10px 20px;
            background: #ecf0f1;
            font-style: italic;
        }

        a {
            color: #3498db;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 2px solid #ecf0f1;
            margin: 30px 0;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background: #3498db;
            color: white;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        strong {
            color: #2c3e50;
        }

        em {
            color: #7f8c8d;
        }

        .toc {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .toc h2 {
            margin-top: 0;
            border-bottom: none;
        }
    </style>
</head>
<body>
    <h1>Dynamic Width Fix - Removing Blank Spaces in Wide Windows</h1>

<h2>Problem Identified</h2>

<p>
After removing the blank lines between verses, there was still a <strong>gap appearing after some long verses</strong> (like Isa 2:19) when the window was opened wide.
</p>

<strong>Root Cause:</strong>
<p>
The <code>sizeHint()</code> method was using a <strong>hardcoded width of 600px</strong> to calculate verse heights, but the actual window width was much larger (~1300px in your screenshot).
</p>

<pre><code># OLD CODE - BROKEN
<p>
default_width = 600  # ← HARDCODED!
text_width = default_width - 16 - 5 - 3 - 3  # = 573px</code></pre>
</p>

<strong>What was happening:</strong>
<ol><li>Window is 1300px wide</li>
<li>sizeHint calculates height assuming 600px width</li>
<li>At 600px, verse 2:19 wraps to 3 lines → needs 45px height</li>
<li>At 1300px, verse 2:19 only wraps to 2 lines → only needs 25px height</li>
<li>Result: <strong>20px of blank space</strong> because widget is too tall</li>
</ol>
<h2>Visual Example</h2>

<pre><code>At 600px width (what sizeHint assumed):
<p>
┌────────────────────────────────────────────┐
│ KJV Isa 2:19 - And they shall go into the │
│ holes of the rocks, and into the caves of  │
│ the earth, for fear...                     │
└────────────────────────────────────────────┘
Height = 45px (3 lines)
</p>

<p>
At 1300px width (actual window size):
┌───────────────────────────────────────────────────────────────────────────────────────┐
│ KJV Isa 2:19 - And they shall go into the holes of the rocks, and into the caves of  │
│ the earth, for fear of the Lord, and for the glory of his majesty, when he ariseth...│
└───────────────────────────────────────────────────────────────────────────────────────┘
Height = 25px (2 lines)
</p>

<p>
But widget was allocated 45px → 20px blank space!</code></pre>
</p>

<h2>Solution Implemented</h2>

<h3>1. Dynamic Width Detection</h3>

<p>
Updated <code>sizeHint()</code> to get the <strong>actual list widget width</strong> instead of using a hardcoded value:
</p>

<pre><code># NEW CODE - FIXED
<p>
actual_width = 600  # Fallback default
</p>

<h1>Walk up the widget tree to find the list widget</h1>
<p>
parent = self.parent()
while parent:
    if hasattr(parent, 'viewport'):
        # Found the list widget - get its actual viewport width
        actual_width = parent.viewport().width()
        break
    parent = parent.parent() if hasattr(parent, 'parent') else None
</p>

<h1>Calculate text width based on ACTUAL window width</h1>
<p>
text_width = actual_width - 16 - 5 - 3 - 3 - 20  # Account for scrollbar</code></pre>
</p>

<h3>2. Resize Event Handler</h3>

<p>
Added <code>resizeEvent()</code> to recalculate verse heights when the window is resized:
</p>

<pre><code>def resizeEvent(self, event):
<p>
    """
    Handle resize events to recalculate verse heights based on new width.
</p>
    
<p>
    When the window is resized, text wrapping changes, so we need to
    recalculate the height of each verse item to match the new width.
    """
    super().resizeEvent(event)
</p>
    
<p>
    # Update all item sizes to match new width
    if hasattr(self, 'verse_items') and self.verse_items:
        self.update_item_sizes()</code></pre>
</p>

<h2>Changes Made to widgets.py</h2>

<h3>Location 1: <code>sizeHint()</code> method (Lines 192-244)</h3>

<strong>Before:</strong>
<pre><code>default_width = 600
<p>
text_width = default_width - 16 - 5 - 3 - 3</code></pre>
</p>

<strong>After:</strong>
<pre><code># Try to get the actual width from the list widget
<p>
actual_width = 600  # Fallback default
</p>

<h1>Walk up the widget tree to find the list widget</h1>
<p>
parent = self.parent()
while parent:
    if hasattr(parent, 'viewport'):
        actual_width = parent.viewport().width()
        break
    parent = parent.parent() if hasattr(parent, 'parent') else None
</p>

<h1>Calculate text width based on actual width</h1>
<p>
text_width = actual_width - 16 - 5 - 3 - 3 - 20
text_width = max(text_width, 400)  # Ensure reasonable minimum</code></pre>
</p>

<h3>Location 2: Added <code>resizeEvent()</code> method (Lines 742-759)</h3>

<pre><code>def resizeEvent(self, event):
<p>
    """Handle resize events to recalculate verse heights"""
    super().resizeEvent(event)
</p>
    
<p>
    if hasattr(self, 'verse_items') and self.verse_items:
        self.update_item_sizes()</code></pre>
</p>

<h2>Expected Results</h2>

<p>
After applying this fix:
</p>

<p>
✅ <strong>No blank spaces</strong> - Verses use correct height for actual window width
✅ <strong>Adapts to window size</strong> - Heights recalculate when you resize the window
✅ <strong>Works at any width</strong> - From narrow (600px) to ultra-wide (2000px+)
✅ <strong>No performance issues</strong> - Only recalculates on resize, not continuously
</p>

<h2>How It Works</h2>

<h3>Initial Display:</h3>
<ol><li>User searches for verses</li>
<li>Verses are added to list</li>
<li><code>sizeHint()</code> gets actual list widget width</li>
<li>Calculates correct height for each verse</li>
<li>No blank spaces!</li>
</ol>
<h3>Window Resize:</h3>
<ol><li>User drags window to make it wider/narrower</li>
<li><code>resizeEvent()</code> is triggered</li>
<li>Calls <code>update_item_sizes()</code></li>
<li>Each verse recalculates its height for new width</li>
<li>Text reflows properly, no blank spaces!</li>
</ol>
<h3>Text Wrapping Example:</h3>

<strong>Narrow window (600px):</strong>
<pre><code>Verse wraps to 3 lines
<p>
Height = 45px</code></pre>
</p>

<strong>Medium window (900px):</strong>
<pre><code>Verse wraps to 2 lines
<p>
Height = 30px</code></pre>
</p>

<strong>Wide window (1300px):</strong>
<pre><code>Verse wraps to 2 lines (longer lines)
<p>
Height = 25px</code></pre>
</p>

<strong>Each width gets the EXACT height needed!</strong>

<h2>Installation</h2>
<ol><li><strong>Backup current file:</strong></li>
</ol>   <pre><code>   cd ~/projects/bible-search-lite
<p>
   cp bible_search_ui/ui/widgets.py bible_search_ui/ui/widgets.py.backup3
   ``<code>
</p>
<ol><li><strong>Replace with updated file:</strong></li>
</ol>   </code>`<code>bash
<p>
   cp /path/to/widgets.py bible_search_ui/ui/widgets.py
</p>
   </code>`<code>
<ol><li><strong>Clear Python cache:</strong></li>
</ol>   </code>`<code>bash
<p>
   find ~/projects/bible-search-lite -name "__pycache__" -type d -exec rm -rf {} +
</p>
   </code>`<code>
<ol><li><strong>Restart application:</strong></li>
</ol>   </code>`<code>bash
<p>
   python bible_search_lite.py
</p>
   </code>`<code>

<h2>Testing</h2>
<ol><li><strong>Test at narrow width:</strong></li>
</ol><ul><li>Resize window to be narrow (~600px wide)</li>
<li>Search for "Isa 2:12-22"</li>
<li>Verify no blank spaces between verses</li>
</ul>
<ol><li><strong>Test at wide width:</strong></li>
</ol><ul><li>Maximize window or make it very wide</li>
<li>Search for "Isa 2:12-22"</li>
<li>Verify no blank spaces (especially after verse 2:19)</li>
</ul>
<ol><li><strong>Test window resizing:</strong></li>
</ol><ul><li>Search for verses</li>
<li>Slowly resize window from narrow to wide</li>
<li>Watch verses reflow smoothly</li>
<li>Verify no blank spaces at any width</li>
</ul>
<ol><li><strong>Test with very long verses:</strong></li>
</ol><ul><li>Search for verses like Esther 8:9 (very long)</li>
<li>Resize window</li>
<li>Verify proper height adjustment</li>
</ul>
<h2>Technical Details</h2>

<h3>Why the Parent Walk?</h3>
</code></pre>python
<p>
parent = self.parent()
while parent:
    if hasattr(parent, 'viewport'):
        actual_width = parent.viewport().width()
        break
    parent = parent.parent()
</p>
<pre><code>
<ul><li></code>VerseItemWidget<code> doesn't know the list width directly</li>
<li>We walk up the widget hierarchy to find the </code>QListWidget<code></li>
<li>QListWidget has a </code>viewport()<code> that gives us the actual display width</li>
<li>This accounts for scrollbars, borders, and actual available space</li>
</ul>
<h3>Why Subtract 20px?</h3>
</code></pre>python
<p>
text_width = actual_width - 16 - 5 - 3 - 3 - 20
</p>
</code>`<code>
<ul><li>16px: Checkbox width</li>
<li>5px: Spacing between checkbox and text</li>
<li>3px: Left margin</li>
<li>3px: Right margin</li>
<li>20px: Scrollbar width (approximate)</li>
<li><strong>Total</strong>: Ensures we don't overestimate available text width</li>
</ul>
<h3>Performance Impact</h3>

<strong>Minimal:</strong>
<ul><li></code>sizeHint()` called only when adding verses or resizing</li>
<li>Not called during scrolling (Qt caches size hints)</li>
<li>Parent walk is fast (typically only 2-3 levels)</li>
<li>Resize only triggers when user actually resizes window</li>
</ul>
<h2>Summary</h2>

<strong>The blank space problem was caused by using a hardcoded width instead of the actual window width.</strong>

<p>
The fix:
</p>
<ol><li>Dynamically detects the real list widget width</li>
<li>Calculates verse heights based on actual available space</li>
<li>Recalculates when window is resized</li>
<li>Results in perfect spacing at any window width</li>
</ol>
<strong>No more blank spaces, regardless of window size!</strong>

</body>
</html>
